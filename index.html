<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Triangular Evolution Walk</title>
    <style>
      :root {
        color-scheme: light;
      }
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #e8e6e3;
        font-family: "Pretendard Variable", "Noto Sans KR", system-ui, -apple-system,
          BlinkMacSystemFont, sans-serif;
      }
      body {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      canvas {
        width: 100vw;
        height: 100vh;
        display: block;
      }
      .controls {
        position: fixed;
        top: 28px;
        left: 50%;
        transform: translateX(-50%);
        display: inline-flex;
        gap: 12px;
        align-items: center;
        background: rgba(232, 230, 227, 0.8);
        border-radius: 999px;
        padding: 10px 16px;
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
      }
      button {
        border: none;
        border-radius: 999px;
        padding: 8px 14px;
        font-size: 14px;
        letter-spacing: 0.02em;
        font-weight: 600;
        background: #111;
        color: #fff;
        cursor: pointer;
      }
      button:disabled {
        opacity: 0.35;
        cursor: default;
      }
      .stage-label {
        font-size: 14px;
        font-weight: 600;
        color: #111;
        min-width: 180px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <canvas id="evolution"></canvas>
    <div class="controls">
      <button id="removeStage">관절 빼기</button>
      <span class="stage-label" id="stageLabel"></span>
      <button id="addStage">관절 추가</button>
    </div>

    <script>
      const canvas = document.getElementById("evolution");
      const ctx = canvas.getContext("2d");
      const stageLabel = document.getElementById("stageLabel");
      const addButton = document.getElementById("addStage");
      const removeButton = document.getElementById("removeStage");

      const STAGES = [
        {
          label: "Stage 1 · Primitive",
          scale: 0.9,
          triangles: [
            { x: 0, y: 0, width: 1.1, height: 1.3, rotation: 0 }
          ]
        },
        {
          label: "Stage 2 · Emerging",
          scale: 0.78,
          triangles: [
            { x: 0.05, y: -0.15, width: 1.05, height: 1.9, rotation: -0.18 },
            { x: -0.4, y: 0.75, width: 0.45, height: 1.35, rotation: -0.55 },
            { x: 0.35, y: 0.75, width: 0.45, height: 1.05, rotation: 0.35 },
            { x: 0, y: -1.5, width: 0.55, height: 0.75, rotation: -0.25 }
          ]
        },
        {
          label: "Stage 3 · Natural",
          scale: 0.92,
          triangles: [
            { x: 0, y: -0.05, width: 1.1, height: 1.1, rotation: 0.04 },
            { x: 0.05, y: -0.95, width: 0.95, height: 1.45, rotation: 0 },
            { x: 0.1, y: -2.25, width: 0.55, height: 0.75, rotation: 0.1 },
            { x: -0.35, y: 0.55, width: 0.42, height: 1.2, rotation: -0.28 },
            { x: -0.4, y: 1.45, width: 0.32, height: 1, rotation: 0.25 },
            { x: 0.4, y: 0.45, width: 0.42, height: 1.3, rotation: 0.35 },
            { x: 0.32, y: 1.45, width: 0.3, height: 1.05, rotation: -0.08 },
            { x: -0.75, y: -0.8, width: 0.28, height: 1.15, rotation: -0.55 },
            { x: 0.75, y: -0.7, width: 0.28, height: 1.25, rotation: 0.35 }
          ]
        },
        {
          label: "Stage 4 · Fluent",
          scale: 1.05,
          triangles: [
            { x: 0, y: -0.05, width: 1.25, height: 1.35, rotation: 0.02 },
            { x: 0.05, y: -1.2, width: 1.05, height: 1.6, rotation: -0.02 },
            { x: 0.12, y: -2.7, width: 0.65, height: 0.85, rotation: 0.08 },
            { x: -0.5, y: 0.35, width: 0.48, height: 1.35, rotation: -0.3 },
            { x: -0.55, y: 1.55, width: 0.35, height: 1.15, rotation: 0.32 },
            { x: 0.48, y: 0.3, width: 0.48, height: 1.4, rotation: 0.38 },
            { x: 0.42, y: 1.6, width: 0.35, height: 1.2, rotation: -0.05 },
            { x: -0.9, y: -1.05, width: 0.32, height: 1.35, rotation: -0.65 },
            { x: -0.95, y: 0, width: 0.26, height: 1.05, rotation: -0.18 },
            { x: 0.95, y: -0.95, width: 0.32, height: 1.35, rotation: 0.35 },
            { x: 0.95, y: 0.05, width: 0.26, height: 1.05, rotation: 0.12 }
          ]
        }
      ];

      const MIN_STAGE = 0;
      const MAX_STAGE = STAGES.length - 1;
      let currentStage = 0;

      function resize() {
        const dpr = window.devicePixelRatio || 1;
        canvas.width = Math.round(window.innerWidth * dpr);
        canvas.height = Math.round(window.innerHeight * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        draw();
      }

      function drawTriangle(cx, cy, width, height, rotation = 0) {
        const half = width / 2;
        const points = [
          { x: -half, y: 0 },
          { x: half, y: 0 },
          { x: 0, y: -height }
        ];

        ctx.beginPath();
        points.forEach((point, index) => {
          const rotatedX = point.x * Math.cos(rotation) - point.y * Math.sin(rotation);
          const rotatedY = point.x * Math.sin(rotation) + point.y * Math.cos(rotation);
          const x = cx + rotatedX;
          const y = cy + rotatedY;
          if (index === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.closePath();
        ctx.fill();
      }

      function draw() {
        ctx.fillStyle = "#e8e6e3";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const stage = STAGES[currentStage];
        const baseLine = canvas.height * 0.6;
        const baseScale = Math.min(canvas.width * 0.35, canvas.height * 0.42);
        const scale = baseScale * stage.scale;
        const stageX = canvas.width / 2;

        const groundWidth = scale * 1.4;
        ctx.fillStyle = "#111111";
        ctx.fillRect(stageX - groundWidth / 2, baseLine + 7, groundWidth, 3.5);

        stage.triangles.forEach(tri => {
          drawTriangle(
            stageX + tri.x * scale,
            baseLine + tri.y * scale,
            tri.width * scale,
            tri.height * scale,
            tri.rotation
          );
        });

        updateControls();
      }

      function updateControls() {
        stageLabel.textContent = STAGES[currentStage].label;
        removeButton.disabled = currentStage <= MIN_STAGE;
        addButton.disabled = currentStage >= MAX_STAGE;
      }

      function changeStage(direction) {
        const nextStage = currentStage + direction;
        if (nextStage < MIN_STAGE || nextStage > MAX_STAGE) return;
        currentStage = nextStage;
        draw();
      }

      window.addEventListener("resize", resize);
      addButton.addEventListener("click", () => changeStage(1));
      removeButton.addEventListener("click", () => changeStage(-1));

      resize();
    </script>
  </body>
</html>
